～前書き～

タッチモジュールの主にホームぺージについて書いてあるはずです

これを書いている現在、手元に実機がないため記憶をもとに書いているため
これ違うんじゃない？と感じたあなたは読み飛ばしてついでに追記・修正してくれると助かる

ちなみに筆者はDjangoの理解度が低いため、
絶対俺の方がくわしいが…？という人は思い切り斜め読みしてもらって構わない。


～実行方法～

1.SAL_Web-master内のmanage.pyを実行し、
2.Webブラウザで http://127.0.0.1:8000/ に接続すると
3.画面が表示される。

1に関して、
python manage.py runserver
python3 manage.py runserver
の2パターンあるが、python3の方でないと
エラーを吐かれた気がするので気を付けてください。
もしかしたら逆かもしれないが。

ちなみに、現在のタッチモジュールは起動時に勝手に実行し、
ブラウザを立ち上げるようになっています。
内容はautostartというファイルを参照のこと
(場所は
~/.config/lxsession/LXDE-pi/autostart
もしくは
/etc/xdg/lxsession/LXDE-pi/autostart
だと思われるがなかったらfindコマンドとかで探してほしい
autostartじゃなかったらすまない)


～環境～

バージョンは不明、実機で確認してほしい
そして追記してほしい

Python
Django
MySQL

で構成されている。
MySQLを使うのに「PyMySQL」を使っているのだが
PythonかDjangoのどちらか（たしかDjango）の最新バージョンに
PyMySQLがはじかれるのでバージョンを落としているはず。
バージョンアップの際と新規で構築した際になんかおかしいなと思ったら思い出してほしい。

展示用に画面端を--kiosk(かこれに類するもの)で切ってあるが、
変更を加えるのに不便だから戻したいというときは上記autostartを確認されたし。
そのまま変更を加える場合は
Ctrl＋Alt＋tでコマンドラインを呼び出すか
Ctrl＋Alt＋F〇でターミナルへ行くと良いと思われる。
(ブラウザを表示している画面はたしかF7)


～データベースについて～

SAL_Web-master/home/views.py、及び
SAL_Web-master/websites/settings.py
を確認するとデータベースについて
データベース"sal"
ユーザー"user"
パスワード"user"
で指定しているためこちらを編集するかデータベースを合わせるかは任せるが注意。

mysql -u user -p  (pass:user)でログイン。
またはsudo mysqlでも強引にはいれた気がする
sal内のimagelistを使用しており、sensorlistは使用していない。
その他のものはマイグレーションした際に自動で追加されたものである。


～ホームページの編集・追加について～

主にいじることになるのが

1.SAL_Web-master/home/static/css/
2.SAL_Web-master/home/
3.SAL_Web-master/templates/

あと確認することがあるのが

4.SAL_Web-master/websites/
5.SAL_Web-master/media/

の中身になると思われる。
あとはよくわからない設定ファイル等なのでいじり方がわかる人はいじってくれ。

新しくページを作るときは3に新しいhtmlファイルを作成し、
2のviews.py、urls.py、に追記することになると思う。
詳しくは後述するが、基本的に他のをまねて書いてみると何とかなる。かもしれない。

1はCSSファイルを置いてあるからいじってほしい
なお、CSSファイルの呼び出しは後述するHTML群のbase.htmlで行っている。
(これもそんなことなかったら気にしなくていいのだが、
common.cssという名前で使っていたら読み込まれないときがあった)

2のurls.pyについてはlogsかsettingかあたりをまねして書いてくれれば良い。
views.pyについては、見てもらえばわかるようにSQL文でデータを引っ張ってきている。
構成としてはどれも同じように書いているため、
コピー&ペーストで必要に応じて変更していくのが良いと思われる。
logsとsensorlogsあたりを参考に書き換えてみてほしい。

3の部分にhtmlファイルを追加していくことになる。
base.html以外のページの1行目でbase.htmlを読み込んでいるため、
全ページに対する変更はbase.html(CSS読込等)に書いていくと良い。
他、中身に関しては雑に説明すると{{ }}、{% %}以外の部分は普通のHTMLファイル、
{{ }}は参照するとき、{% %}は何かを動作させる時、くらいの認識で構わないと思う。
(テンプレートタグというはずなので詳しくは詳しくは調べてみてほしい）

home.htmlは最新の写真と日時を表示、
logs.htmlはすべての写真と日時を表示している。
また、2019年度の開発では使うのがカメラ1台のみとなったため
sensorlogs.htmlとsetting.htmlはリンクを切っているが、
sensorlogs.htmlはセンサーの反応日時とセンサーの名前を表示、
setting.htmlはセンサーごとの名前の確認・変更ができるようになっている。

4は前述のデータベース関連の部分以外は気にしなくて良いと思う。

5のimages、moviesに写真、動画を保存しておくことになっている。
手動で画像データを放り込む時と送られてきているはずのデータを確認するとき
以外に開くことはないかもしれない。
画像・動画データについては一定期間(1年にしたか3か月にしたか1か月にしたかは覚えていないが)
で自動的に消されるようにしてある。
crontab(おそらく/etc/crontab)を確認してみてほしい。